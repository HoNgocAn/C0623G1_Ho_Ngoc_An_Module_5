
<!-- saved from url=(0093)https://onboard.triptease.io/kernel/v7155.90396/kernel-host.html?originHost=furamavietnam.com -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript">//<![CDATA[
(()=>{var Li=Object.create;var Ce=Object.defineProperty,Hi=Object.defineProperties,Cr=Object.getOwnPropertyDescriptor,Ni=Object.getOwnPropertyDescriptors,Wi=Object.getOwnPropertyNames,Ve=Object.getOwnPropertySymbols,Fi=Object.getPrototypeOf,Ot=Object.prototype.hasOwnProperty,kr=Object.prototype.propertyIsEnumerable;var Ir=(r,e,t)=>e in r?Ce(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,C=(r,e)=>{for(var t in e||(e={}))Ot.call(e,t)&&Ir(r,t,e[t]);if(Ve)for(var t of Ve(e))kr.call(e,t)&&Ir(r,t,e[t]);return r},ke=(r,e)=>Hi(r,Ni(e)),Gi=r=>Ce(r,"__esModule",{value:!0});var Rr=(r,e)=>{var t={};for(var n in r)Ot.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Ve)for(var n of Ve(r))e.indexOf(n)<0&&kr.call(r,n)&&(t[n]=r[n]);return t};var y=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Ki=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Wi(e))!Ot.call(r,n)&&n!=="default"&&Ce(r,n,{get:()=>e[n],enumerable:!(t=Cr(e,n))||t.enumerable});return r},E=r=>Ki(Gi(Ce(r!=null?Li(Fi(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r),Ie=(r,e,t,n)=>{for(var i=n>1?void 0:n?Cr(e,t):e,o=r.length-1,s;o>=0;o--)(s=r[o])&&(i=(n?s(e,t,i):s(i))||i);return n&&i&&Ce(e,t,i),i};var g=(r,e,t)=>new Promise((n,i)=>{var o=c=>{try{a(t.next(c))}catch(u){i(u)}},s=c=>{try{a(t.throw(c))}catch(u){i(u)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,s);a((t=t.apply(r,e)).next())});var v=y(($s,$e)=>{var Mr,jr,qr,Dr,Er,Lr,Hr,Nr,Wr,ze,Ct,Fr,Gr,Kr,X,Ur,Vr,zr,Br,$r,Jr,Zr,Yr,Qr,Be;(function(r){var e=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&undefined?define("tslib",["exports"],function(n){r(t(e,t(n)))}):typeof $e=="object"&&typeof $e.exports=="object"?r(t(e,t($e.exports))):r(t(e));function t(n,i){return n!==e&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(o,s){return n[o]=i?i(o,s):s}}})(function(r){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])};Mr=function(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");e(n,i);function o(){this.constructor=n}n.prototype=i===null?Object.create(i):(o.prototype=i.prototype,new o)},jr=Object.assign||function(n){for(var i,o=1,s=arguments.length;o<s;o++){i=arguments[o];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},qr=function(n,i){var o={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&i.indexOf(s)<0&&(o[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(n);a<s.length;a++)i.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(n,s[a])&&(o[s[a]]=n[s[a]]);return o},Dr=function(n,i,o,s){var a=arguments.length,c=a<3?i:s===null?s=Object.getOwnPropertyDescriptor(i,o):s,u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(n,i,o,s);else for(var m=n.length-1;m>=0;m--)(u=n[m])&&(c=(a<3?u(c):a>3?u(i,o,c):u(i,o))||c);return a>3&&c&&Object.defineProperty(i,o,c),c},Er=function(n,i){return function(o,s){i(o,s,n)}},Lr=function(n,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,i)},Hr=function(n,i,o,s){function a(c){return c instanceof o?c:new o(function(u){u(c)})}return new(o||(o=Promise))(function(c,u){function m(A){try{f(s.next(A))}catch(Y){u(Y)}}function P(A){try{f(s.throw(A))}catch(Y){u(Y)}}function f(A){A.done?c(A.value):a(A.value).then(m,P)}f((s=s.apply(n,i||[])).next())})},Nr=function(n,i){var o={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},s,a,c,u;return u={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function m(f){return function(A){return P([f,A])}}function P(f){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,a&&(c=f[0]&2?a.return:f[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,f[1])).done)return c;switch(a=0,c&&(f=[f[0]&2,c.value]),f[0]){case 0:case 1:c=f;break;case 4:return o.label++,{value:f[1],done:!1};case 5:o.label++,a=f[1],f=[0];continue;case 7:f=o.ops.pop(),o.trys.pop();continue;default:if(c=o.trys,!(c=c.length>0&&c[c.length-1])&&(f[0]===6||f[0]===2)){o=0;continue}if(f[0]===3&&(!c||f[1]>c[0]&&f[1]<c[3])){o.label=f[1];break}if(f[0]===6&&o.label<c[1]){o.label=c[1],c=f;break}if(c&&o.label<c[2]){o.label=c[2],o.ops.push(f);break}c[2]&&o.ops.pop(),o.trys.pop();continue}f=i.call(n,o)}catch(A){f=[6,A],a=0}finally{s=c=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}},Wr=function(n,i){for(var o in n)o!=="default"&&!Object.prototype.hasOwnProperty.call(i,o)&&Be(i,n,o)},Be=Object.create?function(n,i,o,s){s===void 0&&(s=o);var a=Object.getOwnPropertyDescriptor(i,o);(!a||("get"in a?!i.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return i[o]}}),Object.defineProperty(n,s,a)}:function(n,i,o,s){s===void 0&&(s=o),n[s]=i[o]},ze=function(n){var i=typeof Symbol=="function"&&Symbol.iterator,o=i&&n[i],s=0;if(o)return o.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},Ct=function(n,i){var o=typeof Symbol=="function"&&n[Symbol.iterator];if(!o)return n;var s=o.call(n),a,c=[],u;try{for(;(i===void 0||i-- >0)&&!(a=s.next()).done;)c.push(a.value)}catch(m){u={error:m}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(u)throw u.error}}return c},Fr=function(){for(var n=[],i=0;i<arguments.length;i++)n=n.concat(Ct(arguments[i]));return n},Gr=function(){for(var n=0,i=0,o=arguments.length;i<o;i++)n+=arguments[i].length;for(var s=Array(n),a=0,i=0;i<o;i++)for(var c=arguments[i],u=0,m=c.length;u<m;u++,a++)s[a]=c[u];return s},Kr=function(n,i,o){if(o||arguments.length===2)for(var s=0,a=i.length,c;s<a;s++)(c||!(s in i))&&(c||(c=Array.prototype.slice.call(i,0,s)),c[s]=i[s]);return n.concat(c||Array.prototype.slice.call(i))},X=function(n){return this instanceof X?(this.v=n,this):new X(n)},Ur=function(n,i,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=o.apply(n,i||[]),a,c=[];return a={},u("next"),u("throw"),u("return"),a[Symbol.asyncIterator]=function(){return this},a;function u(_){s[_]&&(a[_]=function(Q){return new Promise(function(At,Ei){c.push([_,Q,At,Ei])>1||m(_,Q)})})}function m(_,Q){try{P(s[_](Q))}catch(At){Y(c[0][3],At)}}function P(_){_.value instanceof X?Promise.resolve(_.value.v).then(f,A):Y(c[0][2],_)}function f(_){m("next",_)}function A(_){m("throw",_)}function Y(_,Q){_(Q),c.shift(),c.length&&m(c[0][0],c[0][1])}},Vr=function(n){var i,o;return i={},s("next"),s("throw",function(a){throw a}),s("return"),i[Symbol.iterator]=function(){return this},i;function s(a,c){i[a]=n[a]?function(u){return(o=!o)?{value:X(n[a](u)),done:a==="return"}:c?c(u):u}:c}},zr=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n[Symbol.asyncIterator],o;return i?i.call(n):(n=typeof ze=="function"?ze(n):n[Symbol.iterator](),o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o);function s(c){o[c]=n[c]&&function(u){return new Promise(function(m,P){u=n[c](u),a(m,P,u.done,u.value)})}}function a(c,u,m,P){Promise.resolve(P).then(function(f){c({value:f,done:m})},u)}},Br=function(n,i){return Object.defineProperty?Object.defineProperty(n,"raw",{value:i}):n.raw=i,n};var t=Object.create?function(n,i){Object.defineProperty(n,"default",{enumerable:!0,value:i})}:function(n,i){n.default=i};$r=function(n){if(n&&n.__esModule)return n;var i={};if(n!=null)for(var o in n)o!=="default"&&Object.prototype.hasOwnProperty.call(n,o)&&Be(i,n,o);return t(i,n),i},Jr=function(n){return n&&n.__esModule?n:{default:n}},Zr=function(n,i,o,s){if(o==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof i=="function"?n!==i||!s:!i.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return o==="m"?s:o==="a"?s.call(n):s?s.value:i.get(n)},Yr=function(n,i,o,s,a){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof i=="function"?n!==i||!a:!i.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?a.call(n,o):a?a.value=o:i.set(n,o),o},Qr=function(n,i){if(i===null||typeof i!="object"&&typeof i!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof n=="function"?i===n:n.has(i)},r("__extends",Mr),r("__assign",jr),r("__rest",qr),r("__decorate",Dr),r("__param",Er),r("__metadata",Lr),r("__awaiter",Hr),r("__generator",Nr),r("__exportStar",Wr),r("__createBinding",Be),r("__values",ze),r("__read",Ct),r("__spread",Fr),r("__spreadArrays",Gr),r("__spreadArray",Kr),r("__await",X),r("__asyncGenerator",Ur),r("__asyncDelegator",Vr),r("__asyncValues",zr),r("__makeTemplateObject",Br),r("__importStar",$r),r("__importDefault",Jr),r("__classPrivateFieldGet",Zr),r("__classPrivateFieldSet",Yr),r("__classPrivateFieldIn",Qr)})});var Re=y(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.compose=ee.CompositeTransducer=void 0;var kt=class{constructor(e,t){this.a=e,this.b=t}async_(e){return this.b.async_(this.a.async_(e))}sync(e){return this.b.sync(this.a.sync(e))}};ee.CompositeTransducer=kt;function Ui(r,e){return new kt(r,e)}ee.compose=Ui});var Xr=y(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});Je.decompose=void 0;var Vi=Re();function*It(r){r instanceof Vi.CompositeTransducer?(yield*It(r.a),yield*It(r.b)):yield r}Je.decompose=It});var M=y(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});l.syncReturned=l.asyncReturned=l.isReturned=l.isYielded=l.AsyncIteratorHandler=l.by=l.toAsyncIterable=l.isArrayLike=l.asyncIterable=l.iterable=l.toIterable=l.isPromiseLike=l.isAsyncIterable=l.isIterable=l.value=l.key=l.comparators=l.descending=l.ascending=void 0;var W=v();function Ze(r,e){return r<e?-1:r>e?1:0}l.ascending=Ze;function zi(r,e){return r<e?1:r>e?-1:0}l.descending=zi;function Bi(...r){return(e,t)=>{for(let n of r){let i=n(e,t);if(i!=0)return i}return 0}}l.comparators=Bi;function $i(r){return Object.assign(e=>e[r],{name:r})}l.key=$i;function Ji(r){return e=>e[r]}l.value=Ji;function Zi(r){return typeof r=="object"&&Symbol.iterator in r}l.isIterable=Zi;function Yi(r){return typeof r=="object"&&Symbol.asyncIterator in r}l.isAsyncIterable=Yi;function Qi(r){return typeof r=="object"&&"then"in r}l.isPromiseLike=Qi;function Xi(...r){return r}l.toIterable=Xi;function*eo(r){for(let e=0;e<r.length;e++)yield r[e]}l.iterable=eo;function to(r){return W.__asyncGenerator(this,arguments,function*(){for(let t of r)yield yield W.__await(t)})}l.asyncIterable=to;function ro(r){return typeof r=="object"&&typeof r.length=="number"}l.isArrayLike=ro;function no(r){return W.__asyncGenerator(this,arguments,function*(){yield yield W.__await(r)})}l.toAsyncIterable=no;function io(r,e=Ze){return typeof r=="function"?so(r,e):oo(r,e)}l.by=io;function oo(r,e=Ze){return(t,n)=>e(t[r],n[r])}function so(r,e=Ze){return(t,n)=>e(r(t),r(n))}var en=class{constructor(){this.handlers=[],this.state=[]}value(e){this.newState({value:e,done:!1})}error(e){this.newState(e)}close(e){this.newState({value:e,done:!0})}[Symbol.asyncIterator](){return this}next(){return new Promise((e,t)=>{this.newHandler([e,t])})}newState(e){let t=this.handlers.shift();if(typeof t=="undefined")return this.state.push(e);let n=this.state.shift();if(typeof n=="undefined")return this.consume(e,t);this.consume(n,t),this.newState(e)}newHandler(e){let t=this.state.shift();if(typeof t=="undefined")return this.handlers.push(e);let n=this.handlers.shift();if(typeof n=="undefined")return this.consume(t,e);this.consume(t,n),this.newHandler(e)}consume(e,[t,n]){e instanceof Error?n(e):t(e)}};l.AsyncIteratorHandler=en;function ao(r){return r&&typeof r=="object"&&"yielded"in r}l.isYielded=ao;function co(r){return r&&typeof r=="object"&&"returned"in r}l.isReturned=co;function uo(r){return W.__asyncGenerator(this,arguments,function*(){for(;;){let{value:t,done:n}=yield W.__await(r.next());if(n){yield yield W.__await({returned:t});break}else yield yield W.__await({yielded:t})}})}l.asyncReturned=uo;function*lo(r){for(;;){let{value:e,done:t}=r.next();if(t){yield{returned:e};break}else yield{yielded:e}}}l.syncReturned=lo});var tn=y(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});re.dedupe=re.DedupeTransducer=void 0;var te=v(),po=M(),Rt=class{constructor(e){this.comparator=e}async_(e){return te.__asyncGenerator(this,arguments,function*(){var n,i;let o;try{for(var s=te.__asyncValues(e),a;a=yield te.__await(s.next()),!a.done;){let c=a.value;typeof o=="undefined"?yield yield te.__await(c):this.comparator(c,o)!==0&&(yield yield te.__await(c)),o=c}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield te.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){let t;for(let n of e)typeof t=="undefined"?yield n:this.comparator(n,t)!==0&&(yield n),t=n}};re.DedupeTransducer=Rt;function fo(r=po.ascending){return new Rt(r)}re.dedupe=fo});var rn=y(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.drop=ne.DropTransducer=void 0;var Me=v(),Mt=class{constructor(e){if(this.count=e,typeof e=="undefined")throw new Error("Count can not be undefined")}async_(e){return Me.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=Me.__asyncValues(e),s;s=yield Me.__await(o.next()),!s.done;){let a=s.value;--this.count<0&&(yield yield Me.__await(a))}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield Me.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)--this.count<0&&(yield t)}};ne.DropTransducer=Mt;function go(r){return new Mt(r)}ne.drop=go});var nn=y(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.dropWhile=ie.DropWhileTransducer=void 0;var je=v(),jt=class{constructor(e){this.predicate=e}async_(e){return je.__asyncGenerator(this,arguments,function*(){var n,i;let o=!0;try{for(var s=je.__asyncValues(e),a;a=yield je.__await(s.next()),!a.done;){let c=a.value;o&&(o=this.predicate(c)),o||(yield yield je.__await(c))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield je.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){let t=!0;for(let n of e)t&&(t=this.predicate(n)),t||(yield n)}};ie.DropWhileTransducer=jt;function yo(r){return new jt(r)}ie.dropWhile=yo});var Ye=y(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.accept=F.filter=F.FilterTransducer=void 0;var qe=v(),qt=class{constructor(e){this.predicate=e}async_(e){return qe.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=qe.__asyncValues(e),s;s=yield qe.__await(o.next()),!s.done;){let a=s.value;this.predicate(a)&&(yield yield qe.__await(a))}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield qe.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)this.predicate(t)&&(yield t)}};F.FilterTransducer=qt;function on(r){return new qt(r)}F.filter=on;F.accept=on});var Et=y(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.first=se.FirstTransducer=void 0;var oe=v(),Dt=class{async_(e){return oe.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=oe.__asyncValues(e),s;s=yield oe.__await(o.next()),!s.done;){let a=s.value;return yield oe.__await(yield yield oe.__await(a))}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield oe.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)return yield t}};se.FirstTransducer=Dt;function mo(){return new Dt}se.first=mo});var sn=y(Qe=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});Qe.find=void 0;var ho=Ye(),bo=Et(),xo=Re();function vo(r){return(0,xo.compose)((0,ho.filter)(r),(0,bo.first)())}Qe.find=vo});var an=y(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.flatMap=ae.FlatMapTransducer=void 0;var z=v(),Lt=class{constructor(e){this.mapper=e}async_(e){return z.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=z.__asyncValues(e),s;s=yield z.__await(o.next()),!s.done;){let a=s.value;yield z.__await(yield*z.__asyncDelegator(z.__asyncValues(this.mapper(a))))}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield z.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)yield*this.mapper(t)}};ae.FlatMapTransducer=Lt;function wo(r){return new Lt(r)}ae.flatMap=wo});var un=y(G=>{"use strict";Object.defineProperty(G,"__esModule",{value:!0});G.transducer=G.identity=G.IdentityTransducer=void 0;var Ht=class{async_(e){return e}sync(e){return e}};G.IdentityTransducer=Ht;function cn(){return new Ht}G.identity=cn;G.transducer=cn});var Wt=y(ce=>{"use strict";Object.defineProperty(ce,"__esModule",{value:!0});ce.last=ce.LastTransducer=void 0;var De=v(),Nt=class{async_(e){return De.__asyncGenerator(this,arguments,function*(){var n,i;let o;try{for(var s=De.__asyncValues(e),a;a=yield De.__await(s.next()),!a.done;)o=a.value}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield De.__await(i.call(s)))}finally{if(n)throw n.error}}o!==void 0&&(yield yield De.__await(o))})}*sync(e){let t;for(t of e);t!==void 0&&(yield t)}};ce.LastTransducer=Nt;function _o(){return new Nt}ce.last=_o});var ln=y(ue=>{"use strict";Object.defineProperty(ue,"__esModule",{value:!0});ue.map=ue.MapTransducer=void 0;var Ee=v(),Ft=class{constructor(e){this.mapper=e}async_(e){return Ee.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=Ee.__asyncValues(e),s;s=yield Ee.__await(o.next()),!s.done;){let a=s.value;yield yield Ee.__await(this.mapper(a))}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield Ee.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)yield this.mapper(t)}};ue.MapTransducer=Ft;function To(r){return new Ft(r)}ue.map=To});var Kt=y(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.scan=de.ScanTransducer=void 0;var le=v(),Gt=class{constructor(e,t){this.reducer=e,this.seed=t}async_(e){return le.__asyncGenerator(this,arguments,function*(){var n,i;let o=this.seed;yield yield le.__await(o);try{for(var s=le.__asyncValues(e),a;a=yield le.__await(s.next()),!a.done;){let c=a.value;yield yield le.__await(o=this.reducer(o,c))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield le.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){let t=this.seed;yield t;for(let n of e)yield t=this.reducer(t,n)}};de.ScanTransducer=Gt;function So(r,e){return new Gt(r,e)}de.scan=So});var dn=y(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.reduce=void 0;var Po=Re(),Ao=Wt(),Oo=Kt();function Co(r,e){return(0,Po.compose)((0,Oo.scan)(r,e),(0,Ao.last)())}Xe.reduce=Co});var pn=y(et=>{"use strict";Object.defineProperty(et,"__esModule",{value:!0});et.reject=void 0;var ko=Ye();function Io(r){return new ko.FilterTransducer(e=>!r(e))}et.reject=Io});var fn=y(L=>{"use strict";Object.defineProperty(L,"__esModule",{value:!0});L.sum=L.subtract=L.add=L.increment=void 0;function Ro(r){return r+1}L.increment=Ro;function Mo(r,e){return e===void 0?t=>r+t:r+e}L.add=Mo;function jo(r,e){return e===void 0?t=>t-r:r-e}L.subtract=jo;var qo=(r,e)=>r+e;L.sum=qo});var nt=y(S=>{"use strict";Object.defineProperty(S,"__esModule",{value:!0});S.AsyncSequence=S.Sequence=S.sequence=S.range=S.repeat=S.iterate=void 0;var Ut=fn(),Vt=M(),gn=Le();function*tt(r,e){for(;;)yield e,e=r(e)}S.iterate=tt;function*Do(r){for(;;)yield r()}S.repeat=Do;function*Eo(r,e,t=1){if(t===0)throw new Error("step can not be 0");if(e===void 0)yield*tt((0,Ut.add)(t),r);else{let n=Math.abs(t);e<r?yield*zt(tt((0,Ut.subtract)(n),r),(0,gn.takeWhile)(i=>i>=e)):yield*zt(tt((0,Ut.add)(n),r),(0,gn.takeWhile)(i=>i<=e))}}S.range=Eo;function zt(r,...e){return(0,Vt.isIterable)(r)?new rt(r,e):(0,Vt.isArrayLike)(r)?new rt((0,Vt.iterable)(r),e):new Bt(r,e)}S.sequence=zt;var rt=class{constructor(e,t){this.source=e,this.transducers=t}[Symbol.iterator](){return this.transducers.reduce((e,t)=>t.sync(e),this.source)[Symbol.iterator]()}};S.Sequence=rt;var Bt=class{constructor(e,t){this.source=e,this.transducers=t}[Symbol.asyncIterator](){return this.transducers.reduce((e,t)=>t.async_(e),this.source)[Symbol.asyncIterator]()}};S.AsyncSequence=Bt});var hn=y(it=>{"use strict";Object.defineProperty(it,"__esModule",{value:!0});it.single=void 0;var yn=v(),Lo=M(),mn=nt();function Ho(r,...e){return(0,Lo.isIterable)(r)?No((0,mn.sequence)(r,...e)):Wo((0,mn.sequence)(r,...e))}it.single=Ho;function No(r){for(let e of r)return e;throw new Error("Expected a single value")}function Wo(r){var e,t,n,i;return yn.__awaiter(this,void 0,void 0,function*(){try{for(e=yn.__asyncValues(r);t=yield e.next(),!t.done;)return t.value}catch(o){n={error:o}}finally{try{t&&!t.done&&(i=e.return)&&(yield i.call(e))}finally{if(n)throw n.error}}throw new Error("Expected a single value")})}});var $t=y(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.array=void 0;var bn=v(),xn=M(),vn=nt();function Fo(r,...e){return(0,xn.isIterable)(r)||(0,xn.isArrayLike)(r)?Go((0,vn.sequence)(r,...e)):Ko((0,vn.sequence)(r,...e))}ot.array=Fo;function Go(r){let e=[];for(let t of r)e.push(t);return e}function Ko(r){var e,t,n,i;return bn.__awaiter(this,void 0,void 0,function*(){let o=[];try{for(e=bn.__asyncValues(r);t=yield e.next(),!t.done;){let s=t.value;o.push(s)}}catch(s){n={error:s}}finally{try{t&&!t.done&&(i=e.return)&&(yield i.call(e))}finally{if(n)throw n.error}}return o})}});var _n=y(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.sort=pe.SortTransducer=void 0;var He=v(),Uo=M(),wn=$t(),Jt=class{constructor(e){this.comparator=e}async_(e){return He.__asyncGenerator(this,arguments,function*(){let n=yield He.__await((0,wn.array)(e));n.sort(this.comparator),yield He.__await(yield*He.__asyncDelegator(He.__asyncValues(n)))})}*sync(e){let t=(0,wn.array)(e);t.sort(this.comparator),yield*t}};pe.SortTransducer=Jt;function Vo(r=Uo.ascending){return new Jt(r)}pe.sort=Vo});var Tn=y(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.take=fe.TakeTransducer=void 0;var B=v(),Zt=class{constructor(e){if(this.count=e,typeof e=="undefined")throw new Error("Count can not be undefined")}async_(e){return B.__asyncGenerator(this,arguments,function*(){var n,i;if(this.count<1)return yield B.__await(void 0);try{for(var o=B.__asyncValues(e),s;s=yield B.__await(o.next()),!s.done;){let a=s.value;if(yield yield B.__await(a),--this.count<1)return yield B.__await(void 0)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield B.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){if(!(this.count<1)){for(let t of e)if(yield t,--this.count<1)return}}};fe.TakeTransducer=Zt;function zo(r){return new Zt(r)}fe.take=zo});var Sn=y(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.takeWhile=ye.TakeWhileTransducer=void 0;var ge=v(),Yt=class{constructor(e){this.predicate=e}async_(e){return ge.__asyncGenerator(this,arguments,function*(){var n,i;try{for(var o=ge.__asyncValues(e),s;s=yield ge.__await(o.next()),!s.done;){let a=s.value;if(this.predicate(a))yield yield ge.__await(a);else return yield ge.__await(void 0)}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=o.return)&&(yield ge.__await(i.call(o)))}finally{if(n)throw n.error}}})}*sync(e){for(let t of e)if(this.predicate(t))yield t;else return}};ye.TakeWhileTransducer=Yt;function Bo(r){return new Yt(r)}ye.takeWhile=Bo});var An=y(Pn=>{"use strict";Object.defineProperty(Pn,"__esModule",{value:!0})});var Qt=y(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.container=K.lazy=K.replace=void 0;function On(r,e,t){return Object.defineProperty(r,e,{value:t})}K.replace=On;function Cn(r,e,t){if(typeof t.get=="undefined")throw new Error("@lazy can only decorate getter methods");return Object.defineProperty(r,e,Object.assign(Object.assign({},t),{get(){return On(this,e,t.get.call(this))[e]}}))}K.lazy=Cn;function $o(r){return Object.keys(r).reduce((e,t)=>Cn(e,t,{configurable:!0,get:()=>r[t](e)}),{})}K.container=$o});var En=y(at=>{"use strict";Object.defineProperty(at,"__esModule",{value:!0});at.AVLTree=void 0;var kn=v(),st=M(),In=Qt(),H=class{constructor(e){this.comparator=e}static empty(e=st.ascending){return new Rn(e)}static create(e,t,n=st.ascending){let i=H.empty(n);return new k(n,e,t,i,i)}static of(e,t=st.ascending){return H.preSorted(e.sort((0,st.by)(0)),t,H.empty(t))}static preSorted(e,t,n){let i=e.length;switch(i){case 0:return n;case 1:{let[[o,s]]=e;return new k(t,o,s,n,n)}default:{let o=Math.floor(i/2),s=H.preSorted(e.slice(0,o),t,n),a=H.preSorted(e.slice(o+1),t,n),[c,u]=e[o];return new k(t,c,u,s,a)}}}};at.AVLTree=H;var Rn=class extends H{constructor(e){super(e);this.isEmpty=!0,this.height=0,this.balance=0}insert(e,t){return new k(this.comparator,e,t,this,this)}contains(e){return!1}lookup(e){}delete(e){return{tree:this}}first(){}last(){}removeFirst(){return{tree:this}}removeLast(){return{tree:this}}toString(){return""}*keys(){}*values(){}*entries(){return[]}},k=class extends H{constructor(e,t,n,i,o){super(e);this.key=t,this.value=n,this.left=i,this.right=o,this.isEmpty=!1}insert(e,t){let n=this.comparator(e,this.key);return n===0?new k(this.comparator,e,t,this.left,this.right):n<0?this.replaceLeft(this.left.insert(e,t)):this.replaceRight(this.right.insert(e,t))}contains(e){let t=this.comparator(e,this.key);return t===0?!0:t<0?this.left.contains(e):this.right.contains(e)}lookup(e){let t=this.comparator(e,this.key);return t===0?this.value:t<0?this.left.lookup(e):this.right.lookup(e)}delete(e){let t=this.comparator(e,this.key);if(t===0){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};let{tree:s,key:a,value:c}=this.left.removeLast();return{tree:Xt(new k(this.comparator,a,c,s,this.right)),key:this.key,value:this.value}}if(t<0){let{tree:s,key:a,value:c}=this.left.delete(e);return{tree:this.replaceLeft(s),key:a,value:c}}let{tree:n,key:i,value:o}=this.right.delete(e);return{tree:this.replaceRight(n),key:i,value:o}}first(){return this.left.isEmpty?this.value:this.left.first()}last(){return this.right.isEmpty?this.value:this.right.last()}removeFirst(){if(this.left.isEmpty)return{tree:this.right,key:this.key,value:this.value};let{tree:e,key:t,value:n}=this.left.removeFirst();return{tree:this.replaceLeft(e),key:t,value:n}}removeLast(){if(this.right.isEmpty)return{tree:this.left,key:this.key,value:this.value};let{tree:e,key:t,value:n}=this.right.removeLast();return{tree:this.replaceRight(e),key:t,value:n}}replaceLeft(e){return Xt(new k(this.comparator,this.key,this.value,e,this.right))}replaceRight(e){return Xt(new k(this.comparator,this.key,this.value,this.left,e))}toString(){return`(${this.left} ${this.key}=${this.value} ${this.right})`}get balance(){return this.left.height-this.right.height}get height(){return Math.max(this.left.height,this.right.height)+1}*keys(){yield*this.left.keys(),yield this.key,yield*this.right.keys()}*values(){yield*this.left.values(),yield this.value,yield*this.right.values()}*entries(){yield*this.left.entries(),yield[this.key,this.value],yield*this.right.entries()}};kn.__decorate([In.lazy],k.prototype,"balance",null);kn.__decorate([In.lazy],k.prototype,"height",null);function Xt(r){let e=r.balance;return e==-2?Zo(r):e==2?Jo(r):r}function Jo(r){let e=r.left.balance;return e==-1?Yo(r):e==1?Mn(r):r}function Zo(r){let e=r.right.balance;return e==1?Qo(r):e==-1?jn(r):r}function Mn(r){return Dn(r)}function Yo(r){let e=qn(r.left);return Mn(r.replaceLeft(e))}function jn(r){return qn(r)}function Qo(r){let e=Dn(r.right);return jn(r.replaceRight(e))}function qn(r){let e=r.right,t=e.left,n=r.replaceRight(t);return e.replaceLeft(n)}function Dn(r){let e=r.left,t=e.right,n=r.replaceLeft(t);return e.replaceRight(n)}});var Hn=y(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.unique=me.UniqueTransducer=void 0;var Ne=v(),Xo=M(),Ln=En(),er=class{constructor(e){this.comparator=e}async_(e){return Ne.__asyncGenerator(this,arguments,function*(){var n,i;let o=Ln.AVLTree.empty(this.comparator);try{for(var s=Ne.__asyncValues(e),a;a=yield Ne.__await(s.next()),!a.done;){let c=a.value;o.contains(c)||(o=o.insert(c,void 0),yield yield Ne.__await(c))}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=s.return)&&(yield Ne.__await(i.call(s)))}finally{if(n)throw n.error}}})}*sync(e){let t=Ln.AVLTree.empty(this.comparator);for(let n of e)t.contains(n)||(t=t.insert(n,void 0),yield n)}};me.UniqueTransducer=er;function es(r=Xo.ascending){return new er(r)}me.unique=es});var Nn=y(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.WindowedTransducer=be.windowed=void 0;var he=v();function ts(r,e=1,t=!1){return new tr(r,e,t)}be.windowed=ts;var tr=class{constructor(e,t,n){this.size=e,this.step=t,this.remainder=n}async_(e){return he.__asyncGenerator(this,arguments,function*(){var n,i;let o=[],s=0;try{for(var a=he.__asyncValues(e),c;c=yield he.__await(a.next()),!c.done;){let u=c.value;if(s>0){s--;continue}o.push(u),o.length===this.size&&(yield yield he.__await([...o]),o=o.slice(this.step),this.step>this.size&&(s=this.step-this.size))}}catch(u){n={error:u}}finally{try{c&&!c.done&&(i=a.return)&&(yield he.__await(i.call(a)))}finally{if(n)throw n.error}}this.remainder&&(yield yield he.__await([...o]))})}*sync(e){let t=[],n=0;for(let i of e){if(n>0){n--;continue}t.push(i),t.length===this.size&&(yield[...t],t=t.slice(this.step),this.step>this.size&&(n=this.step-this.size))}this.remainder&&(yield[...t])}};be.WindowedTransducer=tr});var Fn=y(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.zipWithIndex=U.zip=U.ZipTransducer=void 0;var ct=v(),Wn=M(),rs=nt(),ut=class{constructor(e){this.other=e}async_(e){return ct.__asyncGenerator(this,arguments,function*(){if(!(0,Wn.isAsyncIterable)(this.other))throw new Error("Unsupported operation exception");let n=e[Symbol.asyncIterator](),i=this.other[Symbol.asyncIterator]();for(;;){let[o,s]=yield ct.__await(Promise.all([n.next(),i.next()]));if(o.done||s.done)return yield ct.__await(void 0);yield yield ct.__await([o.value,s.value])}})}*sync(e){if(!(0,Wn.isIterable)(this.other))throw new Error("Unsupported operation exception");let t=e[Symbol.iterator](),n=this.other[Symbol.iterator]();for(;;){let i=t.next(),o=n.next();if(i.done||o.done)return;yield[i.value,o.value]}}};U.ZipTransducer=ut;function ns(r){return new ut(r)}U.zip=ns;function is(){return new ut((0,rs.range)(0))}U.zipWithIndex=is});var Le=y(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});var x=v();x.__exportStar(Re(),b);x.__exportStar(Xr(),b);x.__exportStar(tn(),b);x.__exportStar(rn(),b);x.__exportStar(nn(),b);x.__exportStar(Ye(),b);x.__exportStar(sn(),b);x.__exportStar(Et(),b);x.__exportStar(an(),b);x.__exportStar(un(),b);x.__exportStar(Wt(),b);x.__exportStar(ln(),b);x.__exportStar(dn(),b);x.__exportStar(pn(),b);x.__exportStar(Kt(),b);x.__exportStar(hn(),b);x.__exportStar(_n(),b);x.__exportStar(Tn(),b);x.__exportStar(Sn(),b);x.__exportStar(An(),b);x.__exportStar(Hn(),b);x.__exportStar(Nn(),b);x.__exportStar(Fn(),b)});var nr=y(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.caching=we.cache=void 0;function ss(r,e,t){if(typeof t.value!="function")throw new Error("@cache can only decorate methods");let n=new WeakMap;function i(o){let s=n.get(o);if(s)return s;let a=new Map;return n.set(o,a),a}return Object.defineProperty(r,e,Object.assign(Object.assign({},t),{value:function(...o){let s=JSON.stringify(o),a=i(this),c=a.get(s);if(typeof c!="undefined"||a.has(s))return c;let u=t.value.call(this,...o);return a.set(s,u),u}}))}we.cache=ss;function as(r){let e=new Map;return function(...t){let n=JSON.stringify(t),i=e.get(n);if(typeof i!="undefined"||e.has(n))return i;let o=r(...t);return e.set(n,o),o}}we.caching=as});var _i=y(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.Uri=p.HostHandler=p.host=p.replace=p.const_=p.modify=p.notFound=p.ok=p.response=p.delete_=p.patch=p.put=p.post=p.get=p.request=p.stringChunk=p.StringBody=p.isBody=void 0;var hi=v();typeof Symbol.asyncIterator=="undefined"&&(Symbol.asyncIterator=Symbol.for("Symbol.asyncIterator"));function ks(r){return typeof r=="object"&&"text"in r&&Symbol.asyncIterator in r}p.isBody=ks;var bt=class{constructor(e){this.value=e}text(){return Promise.resolve(this.value)}[Symbol.asyncIterator](){return hi.__asyncGenerator(this,arguments,function*(){yield yield hi.__await(bi(this.value))})}};p.StringBody=bt;function bi(r){return{text:()=>r,data:()=>new TextEncoder().encode(r)}}p.stringChunk=bi;function Se(r,e,t,n){return{method:r,uri:typeof e=="string"?new Pe(e):e,headers:t||{},body:typeof n=="string"?new bt(n):n}}p.request=Se;function Is(r,e){return Se("GET",r,e)}p.get=Is;function Rs(r,e,t){return Se("POST",r,e,t)}p.post=Rs;function Ms(r,e,t){return Se("PUT",r,e,t)}p.put=Ms;function js(r,e,t){return Se("PATCH",r,e,t)}p.patch=js;function qs(r,e){return Se("DELETE",r,e)}p.delete_=qs;function hr(r,e,t){return{status:r,headers:e||{},body:typeof t=="string"?new bt(t):t}}p.response=hr;function Ds(r,e){return hr(200,r,e)}p.ok=Ds;function Es(r,e){return hr(404,r,e)}p.notFound=Es;function br(r,e,t){return Object.assign({},r,{[e]:t(r[e])})}p.modify=br;function xi(r){return()=>r}p.const_=xi;function vi(r,e){return t=>br(t,r,xi(e))}p.replace=vi;function Ls(r){if(typeof r.uri.authority!="undefined")return r.uri.authority;let e=r.headers.Host;if(typeof e!="string")throw new Error("Bad Request");return e}p.host=Ls;var wi=class{constructor(e,t){this.handler=e,this.host=t}handle(e){return this.handler.handle(br(e,"headers",vi("Host",this.host)))}};p.HostHandler=wi;var Pe=class{constructor(e){let t=Pe.RFC_3986.exec(e);if(!t)throw new Error(`Invalid Uri: ${e}`);let[,,n,,i,o,,s,,a]=t;this.scheme=n,this.authority=i,this.path=o,this.query=s,this.fragment=a}toString(){let e=[];return typeof this.scheme!="undefined"&&e.push(this.scheme,":"),typeof this.authority!="undefined"&&e.push("//",this.authority),e.push(this.path),typeof this.query!="undefined"&&e.push("?",this.query),typeof this.fragment!="undefined"&&e.push("#",this.fragment),e.join("")}toJSON(){return this.toString()}};p.Uri=Pe;Pe.RFC_3986=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/});var Gn=E(Le()),Kn=E(M()),os=E(Le());function rr(r){switch(typeof r){case"undefined":return!0;case"string":return r.trim()==="";case"number":return isNaN(r);case"object":{if(r==null)return!0;if(h.isObject(r))return Object.keys(r).length===0;if(Array.isArray(r))return r.length===0}}return!1}var ve=class{static noWhitespace(e){return e&&typeof e=="string"?e.replace(/\s+/g,""):""}static startWith(e,t){return e?e.substring(0,t.length)===t:e===t}static endsWith(e,t){return e.substring(e.length-t.length,e.length)===t}static isEmpty(e){return e===void 0||e===null?!0:e.trim().length===0}static isEmail(e){return typeof e=="string"&&this.validEmailPattern.test(e)}static isLowerCase(e){return e===e.toLowerCase()&&e!==e.toUpperCase()}static isUpperCase(e){return e===e.toUpperCase()&&e!==e.toLowerCase()}static kebabCase(e){return ve.delimiterCase(e,"-")}static snakeCase(e){return ve.delimiterCase(e,"_")}static delimiterCase(e,t){return e.replace(/([A-Z][a-z]+|\d+)/gm,`${t}$1`).replace(new RegExp(`^${t}`),"").toLowerCase()}static titleCase(e){return ve.isEmpty(e)?"":e.replace(/\w\S*/g,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase())}static camelCase(e){return ve.isEmpty(e)?"":e.replace(/([A-Za-z]+|\d+)/gm,t=>t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()).replace(new RegExp("^."),t=>t.toLowerCase()).replace(new RegExp(/[_\-\s]/g),"")}},xe=ve;xe.validEmailPattern=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function We(r,e,t){if(e(r))return t(r);switch(typeof r){case"undefined":return;case"object":{if(r===null)return null;if(Array.isArray(r))return r.map(n=>We(n,e,t));if(h.isObject(r))return h.keys(r).sort().reduce((n,i)=>{let o=r[i];return n[i]=We(o,e,t),n},{})}}return r}function lt(r,e){switch(typeof r){case"undefined":return;case"object":{if(r===null)return null;if(Array.isArray(r))return r.map(t=>lt(t,e));if(h.isObject(r))return h.keys(r).sort().reduce((t,n)=>{let i=r[n];return t[e(String(n))]=lt(i,e),t},{})}}return r}var h=class{static isObject(e){return e&&typeof e=="object"&&(e.constructor===Object||/Object.*native/.test(e.constructor.toString()))}static keys(e){return Object.keys(e)}static values(e){return Object.keys(e).map(t=>e[t])}static entries(e){return Object.keys(e).map(t=>[t,e[t]])}static removeEmpty(e){return e&&(h.isObject(e)?Object.keys(e).reduce((t,n)=>{let i=h.removeEmpty(e[n]);return rr(i)||(t[n]=i),t},{}):e)}static sort(e){return e&&(Array.isArray(e)?e.map(h.sort):h.isObject(e)?Object.keys(e).sort().reduce((t,n)=>{let i=e[n];return t[n]=h.sort(i),t},{}):e)}static toLowerCase(e){return typeof e=="string"?e.toLowerCase():Array.isArray(e)?e.map(h.toLowerCase):d(()=>h.isObject(e))?Object.entries(e).reduce((t,[n,i])=>(t[n]=h.toLowerCase(i),t),{}):e}static snakeCase(e){return lt(e,xe.snakeCase)}static camelCase(e){return lt(e,xe.camelCase)}static filter(e,t){let n=h.keys(e).filter(t);return h.pick(e,...n)}static omit(e,...t){return t.reduce((n,i)=>(Reflect.deleteProperty(n,i),n),e)}static pick(e,...t){return t.reduce((n,i)=>(n[i]=e[i],n),{})}};var I=class{static from(e){return Array.from(e)}static find(e,t){if(e.find)return e.find(t);let[n]=e.filter(t);return n}static findLastIndex(e,t){let n=[...e].reverse().findIndex(t);return n===-1?n:e.length-n-1}static toObject(e){return e.reduce((t,n)=>(Object.keys(n).forEach(i=>{i in t||(t[i]=n[i])}),t),{})}static flatten(e){return e.reduce((t,n)=>t.concat(n),[])}static flatMap(e,t){return e.flatMap?e.flatMap(t):I.flatten(e.map(t))}static unique(e){return Array.from(new Set(e))}static clean(e){return e.filter(Boolean)}static trim(e){return e.map(t=>t.trim())}static includes(e,t){return"includes"in e?e.includes(t):e.indexOf(t)!==-1}static first(e){return e[0]}static last(e){return e[e.length-1]}static safeReverse(e){return e?e.slice().reverse():[]}static shuffle(e){return e.map(t=>({value:t,order:Math.random()})).sort((0,Kn.by)("order")).map(({value:t})=>t)}};function d(r,e=void 0){try{let t=r();return typeof t=="undefined"?e:t}catch(t){return e}}var j=(()=>typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof module!="undefined"?module:Function("return this")())();function Un(r,e,t){let n=r[e];return typeof n=="undefined"?r[e]=t:Array.isArray(n)?n.indexOf(t)==-1&&n.push(t):r[e]=[n,t],r}function Vn(r,e,t,n=i=>i){let i=[],o=0,s;for(;(s=r.exec(e))!=null;)i.push(n(e.substring(o,s.index))),i.push(t(s)),o=r.lastIndex;return i.push(n(e.substring(o))),i.join("")}var zn=E(nr()),Bn=E(Qt());function $(r=j){return r.triptease=r.triptease||{},r.triptease.onboard=r.triptease.onboard||{},{triptease:r.triptease,onboard:r.triptease.onboard}}var J;(function(n){n.Native="native",n.NonNative="non-native",n.NotImplemented="not-implemented"})(J||(J={}));function $n(r,e){return d(()=>e.split(".").reduce((t,n)=>t[n],r))}function cs(r){return r==null?J.NotImplemented:typeof r=="function"?r.toString().includes("native code")?J.Native:J.NonNative:J.Native}var dt=class{static exposeApi(){let e=$(j).triptease;e.native||(e.native=dt)}static getProperty(e){let t=$n(j,e);return cs(t)!==J.NonNative?t:$n(dt.window,e)}static get window(){let e=j;if(!e.document)return e;try{let t=e.document,n=t.querySelector("[name='triptease.native']");if(n)return n.contentWindow;let i=t.createElement("iframe");return i.style.display="none",i.setAttribute("title","blank"),i.setAttribute("aria-hidden","true"),i.setAttribute("name","triptease.native"),t.documentElement.appendChild(i),i.contentWindow}catch(t){return e}}},O=dt;Ie([zn.cache],O,"getProperty",1),Ie([Bn.lazy],O,"window",1);var us=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}\.\d{3}Z)?$/;function ls(r){return We(r,e=>typeof e=="string"&&us.test(e),e=>{let t=new Date(e);return isNaN(t.valueOf())?e:t})}var ds=O.getProperty("JSON.parse"),ps=O.getProperty("JSON.stringify"),fs=O.getProperty("Date.prototype.toISOString"),q=class{static parse(e){return ds(e)}static parseWithDates(e){return ls(q.parse(e))}static stringify(e){return ps(this.clean(e))}static clean(e){return We(e,t=>{let n=typeof t;switch(n){case"undefined":case"string":case"number":case"boolean":return!0;case"object":{if(t===null)return!0;if(Array.isArray(t)||h.isObject(t))return!1;if("toJSON"in t)return!0}}throw new Error(`Illegal JsonValue: ${n} ${t} `)},t=>t instanceof Date?fs.call(t):t)}static atob(e){return d(()=>q.parseWithDates(Buffer.from(e,"base64").toString("utf-8")))}static btoa(e){return d(()=>Buffer.from(JSON.stringify(e)).toString("base64"))}},R=class{static same(e,t){return q.stringify(e)===q.stringify(t)}static isSuperset(e,t){return e===null||t===null?R.same(e,t):Array.isArray(e)&&Array.isArray(t)?e.length>t.length?!1:e.every(n=>t.some(i=>R.isSuperset(n,i))):d(()=>h.isObject(e))&&d(()=>h.isObject(t))?Object.keys(e).reduce((n,i)=>n&&R.isSuperset(e[i],t[i]),!0):R.same(e,t)}static compress(e){let t=R.groupValues(e);return this.compressGrouped(t)}static compressGrouped(e){return Object.entries(e).reduce(({shared:t,unique:n},[i,o])=>{if(d(()=>h.isObject(o))){let s=R.compressGrouped(o);Object.keys(s.shared).length>0&&(t[i]=s.shared),s.unique.forEach((a,c)=>{n[c]=n[c]||{},Object.keys(a).length>0&&(n[c][i]=a)})}return Array.isArray(o)&&o.forEach((s,a)=>{n[a]=n[a]||{},I.unique(o.map(c=>q.stringify(c))).length===1?t[i]=s:s!==void 0&&(n[a][i]=s)}),{shared:t,unique:n}},{shared:{},unique:[]})}static groupValues(e){let t=Array.from(e.reduce((s,a)=>Object.keys(a).reduce((c,u)=>c.add(u),s),new Set)),[n,i]=e.reduce((s,a)=>t.reduce(([c,u],m)=>{let P=a[m];return d(()=>h.isObject(P))?(u[m]=u[m]||[],u[m].push(P)):(c[m]=c[m]||[],c[m].push(P)),[c,u]},s),[{},{}]),o=Object.entries(i).reduce((s,[a,c])=>(s[a]=R.groupValues(c),s),{});return C(C({},n),o)}static decompress(e){return e.unique.map(t=>this.merge(e.shared,t))}static merge(e,t){return[...Object.keys(e),...Object.keys(t)].reduce((i,o)=>{let s=e[o],a=t[o];return d(()=>h.isObject(s))&&d(()=>h.isObject(a))?i[o]=R.merge(s,a):i[o]=a!=null?a:s,i},{})}};function Fe(r,e=!0){return r?(r.indexOf("?")==0&&(r=r.substring(1,r.length)),r.split("&").map(function(t){return t.split("=")}).reduce(function(t,n){let i=n[0],o=n[1];if(!i)return t;let s=Jn(o),a=e?gs(s):s;return Un(t,Jn(i),a)},{})):{}}function Jn(r){return d(()=>decodeURIComponent(r.replace(/\+/g,"%20")),r)}function gs(r){try{return q.parse(r)}catch(e){return r}}function ys(r){return typeof r=="string"?r:JSON.stringify(r)}function Zn(r,e=!0){return Object.keys(h.removeEmpty(r)).map(t=>{let n=r[t],i=e?ys(n):n;return`${t}=${encodeURIComponent(i)}`}).join("&")}var or=class{constructor(e){let t=or.RFC_3986.exec(e);if(!t)throw new Error(`Invalid Uri: ${e}`);let[,,n,,i,o,,s,,a]=t;this.scheme=n,this.authority=i?new ir(i):void 0,this.path=o,this.query=s,this.fragment=a}toString(){let e=[];return typeof this.scheme!="undefined"&&e.push(this.scheme,":"),typeof this.authority!="undefined"&&e.push("//",this.authority.toString()),e.push(this.path),typeof this.query!="undefined"&&e.push("?",this.query),typeof this.fragment!="undefined"&&e.push("#",this.fragment),e.join("")}get host(){return this.authority&&this.authority.host}get port(){return this.authority&&this.authority.port}get userInfo(){return this.authority&&this.authority.userInfo}},_e=or;_e.RFC_3986=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;var sr=class{constructor(e){let t=sr.RFC_3986.exec(e);if(!t)throw new Error(`Invalid Authority: ${e}`);let[,n,i,o]=t;this.userInfo=n,this.host=i,this.port=o}toString(){let e=[];return typeof this.userInfo!="undefined"&&e.push(this.userInfo,"@"),typeof this.host!="undefined"&&e.push(this.host),typeof this.port!="undefined"&&e.push(":",this.port),e.join("")}},ir=sr;ir.RFC_3986=/(?:([^@]+)@)?([^:]+)(?::([\d]+))?/;var Yn=O.getProperty("console.log"),ms=O.getProperty("console.error"),hs=O.getProperty("console.debug"),Qn=class{constructor(e=Yn,t=ms,n=hs||Yn){this.log=e;this.error=t;this.debug=n}},Xn=class{constructor(){this.log=()=>{};this.error=()=>{};this.debug=()=>{}}},pt="triptease-debug",bs=256;function ei(r,e=pt){let t=d(()=>{var n;return Fe((n=r.location)==null?void 0:n.search,!1)[e]})||d(()=>{var n;return Fe(new _e((n=r.location)==null?void 0:n.originalHref).query,!1)[e]})||d(()=>{var n,i;return(i=(n=r.process)==null?void 0:n.env)==null?void 0:i.DEBUG})||d(()=>{var n;return((n=r.localStorage)==null?void 0:n.getItem)&&r.localStorage.getItem(e)})||d(()=>{var n;return((n=r.sessionStorage)==null?void 0:n.getItem)&&r.sessionStorage.getItem(e)})||"";return d(()=>t.substring(0,bs),"")}function ti(r=j){let e=ei(r,pt);return xe.isEmpty(e)?"":Zn({[pt]:e})}function xs(r){return ei(r,pt).split(",").map(e=>e.trim())}function ri(r){let e=r.replace(/\./g,"\\.").replace(/\*/g,".*");return new RegExp("^"+e+"$")}function vs(r,e=j){try{let t=xs(e),n=t.filter(i=>i[0]==="!").map(i=>i.substr(1));return n.length>0?!n.some(i=>ri(i).test(r)):t.some(i=>i==="true"||ri(i).test(r))}catch(t){return!1}}var ni=class{constructor(e){this.name=e;this.console=new Qn}debug(e,...t){this.console.debug(`[${this.name}] ${e}`,...t)}log(e,...t){this.console.log(`[${this.name}] ${e}`,...t)}error(e,...t){this.console.error(`[${this.name}] ${e}`,...t)}};function T(r,e=j){return vs(r,e)?new ni(r):new Xn}var za=O.getProperty("Date");var ar=class{now(){return new Date}};function ii(r){return new Promise(e=>{this.setTimeout(()=>{e()},r)})}var cr=class{constructor(e=new ar){this.clock=e;this.delay=ii.bind(this);this.delay=ii}task(e){return g(this,null,function*(){return yield this.delay(0),e()})}setTimeout(e,t){return setTimeout(e,t)}clearTimeout(e){clearTimeout(e)}setInterval(e,t){return setInterval(e,t)}clearInterval(e){clearInterval(e)}requestIdleCallback(e,t){let n=t?t.timeout:1,i=this.clock.now().getTime()+n,o=this;return this.setTimeout(()=>{e({didTimeout:!1,timeRemaining(){return Math.max(0,50-(o.clock.now().getTime()-i))}})},n)}cancelIdleCallback(e){this.clearTimeout(e)}};var Za=new cr;function oi(r={credentials:!1}){return e=>g(this,null,function*(){if(typeof fetch!="undefined"){let t=yield fetch(e.url,{method:e.method,headers:e.headers,body:e.body,credentials:r.credentials?"include":"omit"});return{status:t.status,statusDescription:t.statusText,body:yield t.text()}}else{let t=new XMLHttpRequest;return t.open(e.method,e.url,!0),e.headers&&Object.keys(e.headers).forEach(n=>{t.setRequestHeader(n,e.headers[n])}),t.withCredentials=r.credentials,t.send(e.body),new Promise((n,i)=>{t.addEventListener("load",o=>{n({status:t.status,statusDescription:t.statusText,body:t.responseText})}),t.addEventListener("error",o=>{i(o)})})}})}var ai=E(nr());var ws=/\${([^}]+)}/g;function si(r,e){return Vn(ws,r,([,t])=>{var n;return(n=e[t])!=null?n:`\${${t}}`})}var ur=class{static get(){return d(()=>{let e="7155.90396";return e?"v"+e:"latest"})}};var ci=class{constructor(e,t=oi()){this.logger=e;this.httpHandler=t;this.workers={}}createWorker(e,t){return g(this,null,function*(){let n=this.workers[e];return n||(this.workers[e]=yield this.create(t,{name:e}))})}create(e,t){return g(this,null,function*(){try{return new Worker(e,t)}catch(n){this.logger.debug("Failed to create Worker switching to Blob Worker because:",n.message);let i=`location.originalHref = "${e}";
`,s=(yield this.httpHandler({method:"GET",url:e})).body,a=new Blob([i,s],{type:"application/javascript"});return new Worker(URL.createObjectURL(a),t)}})}},ft=class{constructor(e,t=T("application-starter"),n=new ci(t),i=new ui(e,t)){this.window=e;this.logging=t;this.workerFactory=n;this.waiter=i}start(e){return g(this,null,function*(){this.logging.debug(`ApplicationStarter starting app "${e.name}" (${e.type}), ${e.url}`);let t=this.window.document;if(e.type==="worker"){let o=yield this.workerFactory.createWorker(e.name,e.url);return e.startMessage&&(yield this.waiter.waitForMessage(e.startMessage,o)),this.logging.debug("ApplicationStarter returning worker"),o}let n=t.createElement(e.type);n.setAttribute("name",e.name),n.src=si(e.url,{onboard_version:ur.get()});let i=ft.DefaultOptions[e.type]||{};return Object.keys(i).forEach(o=>{n.setAttribute(o.toLowerCase(),i[o])}),this.addElement(n),e.startMessage?yield this.waiter.waitForMessage(e.startMessage):e.type==="script"&&(yield this.waiter.waitForLoadEvent(n)),n})}addElement(e){(this.window.document.body||this.window.document.documentElement).appendChild(e)}static create(e){var n;let t=$(e).triptease.onboard;return t.applicationStarter=(n=t.applicationStarter)!=null?n:new ft(e)}},Ge=ft;Ge.DefaultOptions={script:{defer:"",async:"",crossOrigin:"anonymous"},iframe:{style:"display: none;",sandbox:"allow-scripts allow-same-origin",title:"blank","aria-hidden":"true"}},Ie([ai.cache],Ge.prototype,"start",1);var ui=class{constructor(e,t){this.window=e;this.logging=t}waitForLoadEvent(e){return this.logging.debug("MessageWaiter waiting for load/error event for",e),new Promise((t,n)=>{e.addEventListener("load",t),e.addEventListener("error",i=>n({name:"ScriptError",message:i.message||`Failed to load script "${e.src}"`}))})}waitForMessage(e,t=this.window){return this.logging.debug("MessageWaiter waiting for message",e),new Promise(n=>{this.logging.debug("MessageWaiter creating handler");let i=o=>{try{let s=o.data&&o.data.type,a=s===e;this.logging.debug(`ApplicationStarter message received "${s}", expecting "${e}", matched: ${a}`),a&&(t.removeEventListener("message",i),n(o.data))}catch(s){this.logging.debug("ApplicationStarter error in parsing message",s,o)}};this.logging.debug("MessageWaiter adding listener"),t.addEventListener("message",i)})}};var yc=new Set(["Unknown","PossibleIdentifier"]),mc=new Set(["HotelName","HotelCode","ChainCode"]);var D;(function(u){u.Search="Search",u.RoomsAndRates="RoomsAndRates",u.Confirmation="Confirmation",u.Checkout="Checkout",u.Payment="Payment",u.Group="Group",u.Advert="Advert",u.Partial="Partial",u.Unknown="Unknown"})(D||(D={}));var _s=[D.Payment,D.Confirmation,D.RoomsAndRates,D.Checkout,D.Search,D.Partial,D.Group,D.Unknown,D.Advert];function li(r){return _s.indexOf(r)}var N;(function(n){n.Singleton="Singleton",n.ApplicationHost="ApplicationHost",n.DataSource="DataSource"})(N||(N={}));var Ke="triptease.onboard.kernel";function Ts(r,e,t){return Object.defineProperty(r,e,{value:t})}function di(r,e,t){return Ts(r,e,t)[e]}function pi(r){try{let{target:e,method:t}=dr(r.type);if(e&&t)return!0}catch(e){}return!1}var gt=class{constructor(e,t=T("worker")){this.worker=e;this.logger=t}addListener(e){this.worker.addEventListener("message",t=>{!pi(t.data)||e(t.data,this)})}send(e){try{this.worker.postMessage(e)}catch(t){this.worker.postMessage(JSON.parse(JSON.stringify(e)))}}},Te=class{constructor(e,t,n=lr,i=T("messaging")){this.listener=e;this.allowedOrigins=n;this.logger=i;this.target=this.listener!==t?t:void 0}addListener(e){this.listener&&this.listener.addEventListener("message",t=>{this.disallowedOrigin(t)||!pi(t.data)||e(t.data,new Te(void 0,t.source||this.target))})}disallowedOrigin(e){return e.origin&&this.allowedOrigins.length>0&&this.allowedOrigins.indexOf(new _e(e.origin).host)===-1}send(e){if(this.target)try{this.target.postMessage(e,"*")}catch(t){this.target.postMessage(JSON.parse(JSON.stringify(e)),"*")}}},lr=["onboard.triptease.io","localhost"],Ss=/^(.*)\.([^.]+)$/;function dr(r){let[,e,t]=r.match(Ss)||[];return{target:e,method:t}}function fi(r){return r&&typeof r=="object"&&"name"in r&&typeof r.name=="string"&&"message"in r&&typeof r.message=="string"&&"stack"in r&&typeof r.stack=="string"}function pr(r,e,t){return{name:r,message:e,stack:t!=null?t:""}}var Ti=E(Le());var Si=E($t()),Ae=E(M());var yt,Ps=new Uint8Array(16);function fr(){if(!yt&&(yt=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!yt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return yt(Ps)}var gi=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function As(r){return typeof r=="string"&&gi.test(r)}var yi=As;var w=[];for(mt=0;mt<256;++mt)w.push((mt+256).toString(16).substr(1));var mt;function Os(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(w[r[e+0]]+w[r[e+1]]+w[r[e+2]]+w[r[e+3]]+"-"+w[r[e+4]]+w[r[e+5]]+"-"+w[r[e+6]]+w[r[e+7]]+"-"+w[r[e+8]]+w[r[e+9]]+"-"+w[r[e+10]]+w[r[e+11]]+w[r[e+12]]+w[r[e+13]]+w[r[e+14]]+w[r[e+15]]).toLowerCase();if(!yi(t))throw TypeError("Stringified UUID is invalid");return t}var mi=Os;function Cs(r,e,t){r=r||{};var n=r.random||(r.rng||fr)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=n[i];return e}return mi(n)}var gr=Cs;var yr=()=>d(()=>crypto.randomUUID())||gr(),mr=class{generate(e){if(typeof e!="undefined")throw new Error("UuidGenerator does not support custom lengths");return yr().replace(/-/g,"")}};var Z=class{static get last(){return C({},Z.value)}static get(e,t,n,i,o){let s={clientKey:n,clientName:i,apiKey:o,pageType:e,pagePath:t};if(!rr(Z.value)&&d(()=>{let c=C({},Z.value);return delete c.pageVisitId,R.same(c,s)}))return Z.value;let a=ke(C({},s),{pageVisitId:yr()});return Z.value=a}},V=Z;V.value={};function ht(r,e=V.last){let i=e,{pageVisitId:t}=i,n=Rr(i,["pageVisitId"]);return ke(C({},r),{context:C(C({},n),r.context||{}),pageVisitId:t})}var Pi=E(_i());function*Ai(r){for(let e=0;e<r.frames.length;e++){let t=r.frames[e];yield t,yield*Ai(t)}}function Hs(r,e){return(0,Si.array)(Ai(r),(0,Ti.filter)(t=>d(()=>t.name)===e))}function Oi(r){return r===r.top?0:1+Oi(r.parent)}function xr(r){let[e]=r.sort((0,Ae.by)(Oi,Ae.ascending));return e}function Ns(r){return r.map(e=>d(()=>{var t;return(t=e.triptease.message)==null?void 0:t.payload})).filter(Boolean)}function Ws(r){let[e]=Ns(r).sort((0,Ae.by)(t=>li(t.type),Ae.ascending));return e}function vr(r){return Hs(r.top,Ke)}function Ci(r,e=vr(r)){return e.length===1?N.Singleton:xr(e)===r?N.ApplicationHost:N.DataSource}function wr(r){return d(()=>{var e;return new Pi.Uri((e=r.context.page)==null?void 0:e.url).path})}function ki(r,e){let t=Ws(r);return ht(ke(C({},e),{payload:t}),V.get(t.type,wr(e),t.clientKey,t.clientName,t.apiKey))}function _r(r){return r&&typeof r=="object"&&r.type==="triptease.onboard.request"&&typeof r.requestType=="string"&&typeof r.correlationId=="string"&&Array.isArray(r.payload)}function xt(r){return r&&typeof r=="object"&&r.type==="triptease.onboard.response"&&typeof r.correlationId=="string"}function vt(r,e){return{type:"triptease.onboard.response",correlationId:r,payload:e}}function wt(r,e){return vt(r,pr("NotFound","No handler found for "+e))}function Ii(r){return d(()=>r.payload.name==="NotFound",!1)}function Ri(r,e){return vt(r,pr(e.name,e.message,e.stack))}var Fs=T("messaging"),_t=class{constructor(){this.handlers=new Map}register(e,t){return e.forEach(n=>{if(this.hasHandlerFor(n))throw new Error(`Method name "${n}" already registered to a handler`);this.handlers.set(n,t)}),this}handle(e){return g(this,null,function*(){let t=this.handlers.get(e.requestType);return t?(Fs.debug("Matched message to handler",e,t),yield t.handle(e)):wt(e.correlationId,e.requestType)})}hasHandlerFor(e){return this.handlers.has(e)}};var Tr=T("messaging"),Sr=class{constructor(e){this.target=e}handle(e){return g(this,null,function*(){let t=this.target[e.requestType];if(!t)return Tr.debug("No method found that matches method",e.requestType,this.target),wt(e.correlationId,e.requestType);try{Tr.debug("Found method",e.requestType);let n=yield t.apply(this.target,e.payload);return vt(e.correlationId,n)}catch(n){return Tr.debug("Error trying to in invoke method",e.requestType,n),Ri(e.correlationId,n)}})}};var Mi=class{constructor(e,t){this.messaging=e;this.idGenerator=t}get(e,t,n){return(...i)=>g(this,null,function*(){let o=this.idGenerator.generate(),{payload:s}=yield this.messaging.handle({type:"triptease.onboard.request",requestType:String(t),payload:i,correlationId:o});if(fi(s))throw s;return s})}};function Tt(r,e=new mr){return new Proxy({},new Mi(r,e))}var ji=T("messaging"),Oe=class{constructor(e){this.messageHandler=e;this.promises=new Map;e&&e.addListener(t=>{if(xt(t)){let{correlationId:n}=t,i=this.promises.get(n);i&&(ji.debug("Sender matched response",t),i.resolve(t),this.promises.delete(n))}})}handle(e){return g(this,null,function*(){return ji.debug("Sending request",e),this.messageHandler&&this.messageHandler.send(e),new Promise((t,n)=>{this.promises.set(e.correlationId,{resolve:t,reject:n})})})}};var St=class{constructor(e,t,n=T("messaging")){this.listen=e;this.router=t;this.logger=n;this.rules=[];e.addListener(this.handler.bind(this)),this.addRule(_r,i=>i,i=>i),this.addRule(Ks,Vs,qi)}registerAlias(e,t){if(!this.router.hasHandlerFor(t))throw new Error(`Illegal alias: Method "${t}" is not registered with router`);return this.addRule(Gs(e),Us(t),qi)}handler(e,t){return g(this,null,function*(){if(xt(e))return;this.logger.debug("listenOn received request",e);let n=this.rules.find(s=>s.predicate(e));if(!n)return;let i=n.requestConverter(e),o=yield this.router.handle(i);if(Ii(o)){this.logger.debug(`Handler not found for request "${i.requestType}", potentially for another listener`);return}e.correlationId&&e.correlationId===o.correlationId&&(this.logger.debug("listenOn sending response to sender",o),t.send(n.responseConverter(o)))})}addRule(e,t,n){return this.rules.push({predicate:e,requestConverter:t,responseConverter:n}),this}};function Gs(r){return e=>e.type===r}function Ks(r){return!_r(r)&&!!r.correlationId}function Us(r){return e=>({type:"triptease.onboard.request",requestType:String(r),payload:[e],correlationId:e.correlationId||"fire-and-forget"})}function Vs(r){let{value:e,correlationId:t}=r,{method:n}=dr(r.type);return{type:"triptease.onboard.request",requestType:n,payload:[e],correlationId:t}}function qi(r){return{type:"triptease.onboard.response",correlationId:r.correlationId,value:r.payload}}var Pr=class{constructor(e){this.storage=e}get(e){let t=this.storage.getItem(e);if(t)return q.parseWithDates(t)}set(e,t){return this.storage.setItem(e,JSON.stringify(t)),this}clear(){this.storage.clear()}},Ar=class{constructor(){this.data=new Map}get(e){return this.data.get(e)}set(e,t){return this.data.set(e,t)}clear(){this.data.clear()}};var Ue=class{constructor(e){this.providers=e}static create(...e){return new Ue(e)}getAnonymousIds(){return g(this,null,function*(){return I.unique(I.flatten(yield Promise.all(this.providers.map(e=>d(()=>e.getAnonymousIds(),[])))))})}setAnonymousId(e){return g(this,null,function*(){yield Promise.all(this.providers.map(t=>d(()=>t.setAnonymousId(e))))})}syncAnonymousIds(e){return g(this,null,function*(){return I.unique(I.flatten(yield Promise.all(this.providers.map(t=>d(()=>t.syncAnonymousIds(e),[])))))})}};var Di="triptease-anonymous-id",Pt=class{constructor(e){this.storage=e}getAnonymousIds(){return g(this,null,function*(){return this.get()})}setAnonymousId(e){return g(this,null,function*(){this.syncAnonymousIds([e])})}get(){let e=this.storage.get(Di);return e?Array.isArray(e)?e.flat():[e]:[]}syncAnonymousIds(e){return g(this,null,function*(){let t=this.get(),n=I.unique([...t,...e].flat());return this.storage.set(Di,n),n})}};var Or=class{constructor(e,t,n=Ue.create(new Pt(new Ar),d(()=>new Pt(new Pr(e.localStorage)))),i=T("kernel"),o=Ge.create(e)){this.window=e;this.allowedOrigin=t;this.identityProvider=n;this.logger=i;this.starter=o}get triptease(){let e=this.window.triptease=this.window.triptease||{};return e.onboard={"kernel-host":this},di(this,"triptease",e)}start(){return g(this,null,function*(){this.logger.debug("KernelHost starting"),this.triptease;let e=new Te(this.window,this.window.parent,[...lr,this.allowedOrigin],this.logger),t=yield this.starter.start(zs()),n=new gt(t),i=new Oe(n);this.kernel=Tt(i);let o=new Oe(e);this.bootstrap=Tt(o),new St(e,this.router=new _t().register(["getPageState","startApp","processConfig","getAnonymousIds","setAnonymousId","syncAnonymousIds"],new Sr(this)).register(["generateConfig","applicationConfig"],i)).registerAlias("triptease.config","processConfig"),new St(n,new _t().register(["trackError","trackMessage"],o)),e.send({type:"triptease.onboard.kernel-host-started"}),this.logger.log("KernelHost started")})}startApp(e){return g(this,null,function*(){let t=yield this.starter.start(e),n=new Oe(new gt(t));this.router.register(e.requestTypes,n)})}getAnonymousIds(){return this.identityProvider.getAnonymousIds()}setAnonymousId(e){return g(this,null,function*(){yield this.identityProvider.setAnonymousId(e)})}syncAnonymousIds(e){return this.identityProvider.syncAnonymousIds(e)}getPageState(){return g(this,null,function*(){return V.last})}processConfig(e){return g(this,null,function*(){let t=this.window;$(t).triptease.message=e;let n=vr(t.top),i=Ci(t,n);switch(this.logger.log(`Kernel Host is in ${i} mode`),i){case N.Singleton:return this.bootstrap.processConfig(ht(e,V.get(e.payload.type,wr(e),e.payload.clientKey,e.payload.clientName,e.payload.apiKey)));case N.ApplicationHost:let o=ki(n,e);return this.bootstrap.processConfig(o);case N.DataSource:let s=Tt(new Oe(new Te(void 0,xr(n))));return this.logger.log("Sending triptease.config message to kernel host in application host mode",e.payload),s.processConfig(e)}})}};function zs(){return{name:Ke,url:`kernel.js?${ti()}`,type:"worker",startMessage:`${Ke}-started`,enabled:!0}}(()=>g(void 0,null,function*(){yield new Or(window,Fe(location.search).originHost).start()}))();})();
//]]></script></head><body></body></html>